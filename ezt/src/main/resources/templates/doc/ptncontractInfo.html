<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="Content">
<head>
<link href="/css/doc/jquery.signaturepad.css" rel="stylesheet">
<script src="/js/doc/jquery.signaturepad.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<title>동업 계약서 상세</title>

<style>
.hr-sect {
	display: flex;
	flex-basis: 100%;
	align-items: center;
	color: gray;
	font-size: 20px;
	margin: 8px 0px;
}

.hr-sect::before, .hr-sect::after {
	content: "";
	flex-grow: 1;
	background: rgba(0, 0, 0, 0.35);
	height: 1px;
	font-size: 0px;
	line-height: 0px;
	margin: 0px 16px;
}

.uploadDiv label {
	display: inline-block;
	padding: 5px 20px 10px 20px;
	color: #fff;
	vertical-align: middle;
	background-color: #999999;
	cursor: pointer;
	height: 40px;
}

.uploadDiv input[type="file"] {
	position: absolute;
	width: 0;
	height: 0;
	padding: 0;
	overflow: hidden;
	border: 0;
}

.con_ul li div:nth-child(1) {
	margin-top: 6px;
}

.con_ul li div:nth-child(2) {
	height: 38px;
}

canvas {
	border: 1px solid black;
	width: 260px;
	height: 100px;
}

.unity{
	word-break : keep-all;
	overflow-wrap : break-word;
}
</style>
</head>
<body>

		<div class="container">
			<div class="row mb-5">
				<form class="p-4 p-md-5 border rounded">
					<div class="row form-group">
						<div class="col">
							<h3 class="text-black mb-5 border-bottom pb-2">
									<b>동업 계약서 상세</b>
						<th:block th:if="${con.contractState == 'G01'}">
							<span class="fs-6 fw-light text-success">[ 서명 중 ]</span>
						</th:block>
						<th:block th:if="${con.contractState == 'G02'}">
							<span class="fs-6 fw-light text-success">[ 서명 완료 ]</span>
						</th:block>
							</h3>
							<p class="hr-sect">
								<b>공사개요</b>
							</p>
							<div class="row form-group">
								<div class="col-6">
									<label><b>공사명</b></label>
									<p class="text-black">[[${con.cttName}]]</p>
								</div>
							</div>

							<div class="row form-group">
								<div class="col-10">
									<label><b>공사주소</b></label>
									<p class="text-black">[[${'(' + reqInfo.postcode + ') '
										+reqInfo.address + ' ' + reqInfo.detailAddress}]]</p>
								</div>
								<div class="col-2">
									<label><b>공사면적</b></label>
									<p class="text-black">[[${reqInfo.cttPlaceArea}]]</p>
								</div>
							</div>

							<!-- datepicker : id&type="text"-->
							<div class="row form-group">
								<div class="col-4">
									<label><b>공사시작날짜</b></label>
									<p class="text-black">[[${#dates.format(con.cttStartDt,
										'yyyy-MM-dd')}]]</p>
								</div>
								<div class="col-4">
									<label><b>공사마감날짜</b></label>
									<p class="text-black">[[${#dates.format(con.cttEndDt,
										'yyyy-MM-dd')}]]</p>
								</div>
								<div class="col-4">
									<label><b>하자보수기간</b></label> <input type="text"
										class="form-control">
								</div>
							</div>
							<!-- datepicker -->

							<p class="hr-sect" style="margin-top: 50px;">
								<b>공사대금</b>
							</p>
							<div class="row form-group"
								style="padding-top: 20px; margin-bottom: 30px">
								<div class="col-2">
									<h5 class="text-black" style="padding-top: 10px">
										<b>총 공사금액 </b>
									</h5>
								</div>
								<div class="col">
									<p class="text-black h5" style="margin-top: 8px">
										[[${#numbers.formatInteger(con.cttPrice,1,'COMMA')}]]<b> 원</b>
									</p>
								</div>

							</div>
							<p class="text-black">
								<b>대금 지급 시기</b>
							</p>
							<div class="p-4 mb-3 bg-white border p-4 rounded">
								<table class="table table-hover">
									<thead>
										<tr class="text-center">
											<th scope="col" width="60px">횟수</th>
											<th scope="col" width="150px">금액</th>
											<th scope="col" width="150px">일시</th>
											<th scope="col">내역</th>
										</tr>
									</thead>
									<tbody class="content">
										<th:block th:each=" list : ${con.dList}">
											<tr class="text-center">
												<td th:text="${list.round}" />
												<td
													th:text="${#numbers.formatInteger(list.price,1,'COMMA')} + 원" />
												<td
													th:text="${#dates.format(list.paymentDt,
											'yyyy-MM-dd')}" />
												<td th:text="${list.history}" />
											</tr>
										</th:block>
									</tbody>
								</table>
							</div>


							<p class="hr-sect" style="margin-top: 50px;">
								<b>계약일반조건</b>
							</p>

							<section class="site-section" id="accordion" style="padding: 0">
								<div class="container">
									<div class="row accordion justify-content-center block__76208">
										<div class="col">
											<div class="accordion-item">
												<h3 class="mb-0 heading ms-1">
													<a class="btn-block h4" data-bs-toggle="collapse"
														href="#collapseFive" role="button" aria-expanded="false"
														aria-controls="collapseFive">[[${unity.title}]]<span
														class="icon"></span>
													</a>
												</h3>
												<div id="collapseFive" class="collapse"
													aria-labelledby="headingOne" data-parent="#accordion">
													<div class="body-text unity px-5 mb-4">
														<p>[[${unity.contractTermsContent}]]</p>
													</div>
												</div>
											</div>
											<!-- .accordion-item -->
										</div>
									</div>
								</div>
							</section>



							<div class="row form-group">
								
								<div class="col-6 info_req" style="padding-top: 60px">
									<div class="p-4 mb-3 bg-white border p-4 rounded">
										<h3 class="mt-3 h5 pl-3 mb-3 ">동업자 "갑"</h3>
										<ul class="list-unstyled pl-3 mb-0 con_ul">

											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">성명</strong>
												</div>
												<div class="col-4">
													<p class="text-black" style="margin: 5px 0">[[${requester.usersName}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">전화번호</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${requester.usersPhone}]]</p>
												</div></li>
												<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">공사 담당 분야</strong>
												</div>
												<div class="col">
													<p class="text-black m-0 mt-1">[[${leaderCode}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">우편번호</strong>
												</div>
												<div class="col-3">
													<p class="text-black" style="margin: 5px 0"
														id="input_postcode"></p>
												</div>
												<div class="col"></div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">주소</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0" id="input_addr"></p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">상세주소</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0"
														id="input_detailAddr"></p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">주민등록번호</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${requester.usersRnn}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">계좌번호</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${con.requesterBankcode}]]</p>
												</div></li>
												<li class="mb-2 row form-group"><div class="col-4">
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${con.requesterAccount}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">서명</strong>
												</div>
												<div class="col h-75">
												<div id="input_sign_req" class="text-center mt-2">
												<canvas id="signatureCanvas_req"></canvas></div>
												</div></li>
										</ul>
									</div>
								</div>


								<div class="col-6 info_worker" style="padding-top: 60px">
									<div class="p-4 mb-3 bg-white border p-4 rounded">
										<h3 class="mt-3 h5 pl-3 mb-3 ">동업자 "을"</h3>
										<ul class="list-unstyled pl-3 mb-0 con_ul">

											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">성명</strong>
												</div>
												<div class="col-4">
													<p class="text-black" style="margin: 5px 0">[[${worker.usersName}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">전화번호</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${worker.usersPhone}]]</p>
												</div></li>
												<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">공사 담당 분야</strong>
												</div>
												<div class="col">
													<p class="text-black m-0 mt-1">[[${memberCode}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">우편번호</strong>
												</div>
												<div class="col-3">
													<p class="text-black" style="margin: 5px 0"
														id="input_postcode"></p>
												</div>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">주소</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0" id="input_addr"></p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">상세주소</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0"
														id="input_detailAddr"></p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">주민등록번호</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${worker.usersRnn}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
													<strong class="text-black">계좌번호</strong>
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${con.workerBankcode}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-4">
												</div>
												<div class="col">
													<p class="text-black" style="margin: 5px 0">[[${con.workerAccount}]]</p>
												</div></li>
											<li class="mb-2 row form-group"><div class="col-3">
													<strong class="text-black">서명</strong>
												</div>
												<div class="col h-75">
													<div id="input_sign_work" class="text-center mt-2">
														<canvas id="signatureCanvas_work"></canvas>
													</div>
												</div></li>
										</ul>
									</div>
								</div>

								<p class="text-center text-black mt-5">
								<b>"갑"과 "을"은 상호 신의와 성실을 원칙으로 이 계약서에 의하여 동업계약을 체결하고 계약서 2부를
										작성하여 각각 1부씩 보관한다.</b>
								</p>
								<p class="text-center" style="letter-spacing: 3px">
									<b><span class="me-5 cur_year">2024년</span><span
										class="me-5 cur_month">06월</span><span class="me-5 cur_day">28일</span></b>
								</p>
								<p class="uploadTitle mt-5">첨부 파일</p>
								<div class="col" id="fileDownload"></div>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="row align-items-center mb-5">
				<div class="col-lg-4 ml-auto" style="padding-top: 30px">
					<div class="row">
					
					
						<th:block th:if="${#authentication.principal.userNo == con.workerInfo} and ${con.contractState == null}">
						<div class="col-6">
									
									<button type="submit" class="btn btn-block btn-light btn-md"
								th:onClick="|location.href='@{/conUpdate(proposalNo=${con.proposalNo})}'|">수정</button>
						</div>
						<div class="col-6">
							<button type="button" class="btn btn-block btn-primary btn-md"
								th:onClick="|location.href='@{/sendCon(proposalNo=${con.proposalNo}, type=0)}'|">보내기</button>
						</div>
						</th:block>
					
						<th:block th:if="${#authentication.principal.userNo == con.requesterInfo} and ${con.contractState == 'G01'}">
						<div class="col-6">
							<button type="submit" class="btn btn-block btn-light btn-md"
								th:onClick="|location.href='@{/conWrite(proposalNo=${con.proposalNo})}'|">수정</button>
						</div>
						
						<div class="col-6">
									<button type="button" class="btn btn-block btn-primary btn-md"
								th:onClick="|location.href='@{/sendCon(proposalNo=${con.proposalNo}, type=1)}'|">서명 완료</button>
						</div>
						</th:block>
					</div>
				</div>
			</div>
		</div>
	



	<script th:inline="javascript">
	
	// 년원일 표기
	var date = /*[[${#dates.format(con.updateDt,'yyyy-MM-dd')}]]*/""
	var date_num1 =  date.indexOf('-');
	var date_num2 = date.indexOf('-', date_num1 + 1)
	$('.cur_year').html(date.substring(0, date_num1) + '년');
    $('.cur_month').html(date.substring(date_num1 + 1, date_num2) + '월');
    $('.cur_day').html(date.substring(date_num2 + 1,) + '일');
    
    
    // 주소 표기
    if(/*[[${con.workerAddress}]]*/"" != null){
    var work_addr = /*[[${con.workerAddress}]]*/""
	var work_num1=  work_addr.indexOf('_');
	var work_num2 = work_addr.indexOf('_', work_num1 + 1)
	$('.info_worker #input_postcode').html(work_addr.substring(0, work_num1));
    $('.info_worker #input_addr').html(work_addr.substring(work_num1 + 1, work_num2));
    $('.info_worker #input_detailAddr').html(work_addr.substring(work_num2 + 1,));
    }
    
 	// 주소 표기
 	if(/*[[${con.requesterAddress}]]*/"" != null){
    var req_addr = /*[[${con.requesterAddress}]]*/""
	var req_num1=  req_addr.indexOf('_');
	var req_num2 = req_addr.indexOf('_', req_num1 + 1)
	$('.info_req #input_postcode').html(req_addr.substring(0, req_num1));
    $('.info_req #input_addr').html(req_addr.substring(req_num1 + 1, req_num2));
    $('.info_req #input_detailAddr').html(req_addr.substring(req_num2 + 1,));
    }
	
 	// 통일 계약서 표기
    var unity_origin = /*[[${unity.contractTermsContent}]]*/""
    var unity_content = unity_origin.replaceAll('\n', '<br />');
    $('.unity p').html(unity_content);
 	
 	
 	let fileList = /*[[${con.fileList}]]*/""
 
	// 첨부 파일 다운로드 
	for(i = 0; i < fileList.length; i++){
		var path = fileList[i].savePath.replaceAll('\\', '/');
		var orgname = fileList[i].originalFileName;
		var name = fileList[i].saveName;
		var ext = fileList[i].ext;
		//console.log(path+'/'+name);
		$('#fileDownload').append(`<p><a href="download?fileName=${path}/${name}_${orgname}.${ext}">${orgname}.${ext}</a></p> `)
	}
	
		// 서명 표기
		var workSign = /*[[${con.worSign.signsContent}]]*/"";

		
		if(workSign != null){
		 signView(workSign, 0);
		}
		
		var reqSign = /*[[${con.reqSign.signsContent}]]*/"";

		
		if(reqSign != null){
		 signView(reqSign, 1);
		}
		
    function signView(compressedSignatureData, num) {
        //console.log("compressedSignatureData = " + compressedSignatureData);
        
        // 압축된 데이터 복원
        let decompressedSignatureData 
                  = LZString.decompressFromBase64(compressedSignatureData);

        // 복원된 서명을 JSON화
        let signatureData = JSON.parse(decompressedSignatureData);

        // 서명 그리기
        drawSignature(signatureData, num);
    }
	
    function drawSignature(data, num) {
        // Canvas / 컨텍스트
        let canvas;
        if(num == 0){
        canvas = document.getElementById('signatureCanvas_work');
        }else{
        	canvas = document.getElementById('signatureCanvas_req');
        }
        
        let ctx = canvas.getContext('2d');
        
     	// 캔버스 초기화
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        for (let i = 0; i < data.length; i++) {
        	let point = data[i];
            ctx.moveTo(point.mx, point.my);
            ctx.lineTo(point.lx, point.ly);
        }
        ctx.stroke();
        
        
    }

	</script>

</body>
</html>