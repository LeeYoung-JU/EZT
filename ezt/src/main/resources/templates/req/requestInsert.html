<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/default_layout}"
      layout:fragment="Content">

<head>

<script src="https://kit.fontawesome.com/fdebdddca5.js" crossorigin="anonymous"></script>
<meta charset="UTF-8">
<title>의뢰 신청</title>
</head>
<body>
<h3>의뢰 신청</h3>
<form name="insertRequest" th:action="@{/request/insert}" th:object="${requestVO}" method="post">
	<table class="table">
		<tr>
			<td><input type="hidden" name="requestNo"></td>
			<td><input type="hidden" name="requestState"></td>
			<td><input type="hidden" name="requester" th:value="${#authentication.principal.userNo}"></td>
		</tr>
		<tr>
			<th>제목</th>
			<td colspan="3"><input type="text" name="title"/>
		</tr>
		<tr>
			<th>시공분야</th>
			<td colspan="3">
				<select th:field="*{categoryCode}" >
                    <option th:each="category :${categoryCode}" th:value="${category.codeNo}" th:text="${category.codeName}"></option>
                </select>
			</td>
		</tr>
		<tr>
			<th>희망시공일정</th>
			<td><input type="date" name="hopeCttStartDt" ></td>
			<td>~</td>
			<td><input type="date" name="hopeCttEndDt"  ></td>
		</tr>
		<tr>
			<th>희망시공예산</th>
			<td colspan="3"><input type="text" name="hopeCttBudget"/>
		</tr>
		<tr>
			<th>시공공간</th>
			<td colspan="3">
				<select th:field="*{cttPlace}" >
                    <option th:each="category :${cttPlace}" th:value="${category.codeNo}" th:text="${category.codeName}"></option>
                </select>		
			</td>
		</tr>
		<tr>
			<th>시공공간상황</th>
			<td colspan="3">
				<select th:field="*{cttPlaceSituation}" >
                    <option th:each="category :${cttPlaceSituation}" th:value="${category.codeNo}" th:text="${category.codeName}"></option>
                </select>
			</td>
		</tr>
		<tr>
			<th>시공공간면적</th>
			<td colspan="3"><input type="text" name="cttPlaceArea" style="width:50px;">평</td>
		</tr>		
		<tr>
			<th>의뢰 상세 내용</th>
			<td colspan="3"><textarea name="content" style="width:500px; height:200px;"></textarea></td>
		</tr>
		<tr>
           <th>우편번호</th>
           <td><input type="text" name="postcode" id="input_postcode" ></td>
           <td><button type="button" class="btn btn-secondary postcode" onclick="input_execDaumPostcode()">우편번호 찾기</button></td>
        </tr>
        <tr>
           <th>주소</th>
           <td colspan="3"><input name="address" style="width:300px;" class="input" type="text" id="input_addr" ></td>
        </tr>
        <tr>
           <th>상세주소</th>    
           <td colspan="3"><input name="detailAddress" style="width:300px;" class="input" type="text" id="input_detailAddr"></td>
        </tr>    
			
	</table>
	<div id='image_preview'>
		<h3>이미지 첨부하기</h3>
		<input type='file' id='btnAtt' multiple='multiple'/>
		<div id='att_zone' 
		      data-placeholder='파일을 첨부 하려면 파일 선택 버튼을 클릭하거나 파일을 드래그앤드롭 하세요'></div>
	</div>
		<button type="submit" class="btn btn-primary insertBtn">등록</button>

</form>

<script>
	    (function () {
	        var attZone = document.getElementById('att_zone');
	        var btnAtt = document.getElementById('btnAtt');
	        var sel_files = [];

	        // 이미지와 체크 박스를 감싸고 있는 div 속성
	        var div_style = 'display:inline-block;position:relative;width:150px;height:120px;margin:5px;border:1px solid #00f;z-index:1';
	        // 미리보기 이미지 속성
	        var img_style = 'width:100%;height:100%;z-index:none';
	        // 이미지안에 표시되는 체크박스의 속성
	        var chk_style = 'width:30px;height:30px;position:absolute;font-size:24px;right:0px;bottom:0px;z-index:999;background-color:rgba(255,255,255,0.1);color:#f00';

	        btnAtt.addEventListener('change', function (e) {
	            var files = e.target.files;
	            var remainingSlots = 5 - sel_files.length;

	            if (files.length > remainingSlots) {
	                alert("이미지 첨부는 최대 5장까지 가능합니다.");
	                // 초과된 파일 제거
	                for (var i = 0; i < files.length; i++) {
	                    if (i >= remainingSlots) {
	                        break;
	                    }
	                    sel_files.push(files[i]);
	                    imageLoader(files[i]);
	                }
	                e.preventDefault();
	                return;
	            }

	            for (var i = 0; i < files.length; i++) {
	                sel_files.push(files[i]);
	                imageLoader(files[i]);
	            }
	        });

	        // 탐색기에서 드래그앤 드롭 사용
	        attZone.addEventListener('dragenter', function (e) {
	            e.preventDefault();
	            e.stopPropagation();
	        }, false);

	        attZone.addEventListener('dragover', function (e) {
	            e.preventDefault();
	            e.stopPropagation();
	        }, false);

	        attZone.addEventListener('drop', function (e) {
	            var files = e.dataTransfer.files;
	            var remainingSlots = 5 - sel_files.length;

	            if (files.length > remainingSlots) {
	                alert("이미지 첨부는 최대 5장까지 가능합니다.");
	                // 초과된 파일 제거
	                for (var i = 0; i < files.length; i++) {
	                    if (i >= remainingSlots) {
	                        break;
	                    }
	                    sel_files.push(files[i]);
	                    imageLoader(files[i]);
	                }
	                e.preventDefault();
	                return;
	            }

	            for (var i = 0; i < files.length; i++) {
	                sel_files.push(files[i]);
	                imageLoader(files[i]);
	            }
	        }, false);

	        // 이미지 로딩 및 미리보기 추가
	        function imageLoader(file) {
	            var reader = new FileReader();
	            reader.onload = function (ee) {
	                var img = document.createElement('img');
	                img.setAttribute('style', img_style);
	                img.src = ee.target.result;
	                attZone.appendChild(makeDiv(img, file));
	            };
	            reader.readAsDataURL(file);
	        }

	        // 미리보기 div 생성
	        function makeDiv(img, file) {
	            var div = document.createElement('div');
	            div.setAttribute('style', div_style);

	            var btn = document.createElement('input');
	            btn.setAttribute('type', 'button');
	            btn.setAttribute('value', 'x');
	            btn.setAttribute('delFile', file.name);
	            btn.setAttribute('style', chk_style);
	            btn.onclick = function (ev) {
	                var ele = ev.srcElement;
	                var delFile = ele.getAttribute('delFile');
	                for (var i = 0; i < sel_files.length; i++) {
	                    if (delFile == sel_files[i].name) {
	                        sel_files.splice(i, 1);
	                        break;
	                    }
	                }
	                attZone.removeChild(ele.parentNode);
	            };

	            div.appendChild(img);
	            div.appendChild(btn);
	            return div;
	        }
	    })();
	</script>




<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="/js/doc/postcode.js"></script>
</body>
</html>