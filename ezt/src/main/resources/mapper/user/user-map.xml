<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.usr.mapper.UserMapper">
	<select id="selectUserInfo" resultType="UserVO">
		SELECT users_no
				, users_id
				, users_pw
				, users_email
				, users_birth
				, users_rnn
				, users_gender
				, users_name
				, users_phone
				, users_nick
				, users_role
				, users_join_dt
				, users_state_change_dt
				, users_state
				, file_id
		FROM users
		WHERE users_id = #{id}
	</select>
	
	<select id="idChk" resultType="int">
		SELECT COUNT(*)
		FROM users
		WHERE users_id = #{usersId}
	</select>
	
	<select id="emailChk" resultType="int">
		SELECT COUNT(*)
		FROM users
		WHERE users_email = #{usersEmail}
	</select>
	
	<select id="nickChk" resultType="int">
		SELECT COUNT(*)
		FROM users
		WHERE users_nick = #{usersNick}
	</select>
	
	<insert id="saveUser" parameterType="com.yedam.app.usr.service.UserVO">
		INSERT INTO users
		(users_no, users_role, users_id, users_pw, users_name, users_phone, users_nick, users_email, users_rnn)
		VALUES(SEQ_USERS.NEXTVAL, #{usersRole}, #{usersId}, #{usersPw}, #{usersName}, #{usersPhone}, #{usersNick}, #{usersEmail}, #{usersRnn})
	</insert>
	
	<insert id="saveWorker" parameterType="com.yedam.app.usr.service.UserVO">
    <selectKey keyProperty="usersNo" resultType="Integer" order="BEFORE">
        SELECT SEQ_USERS.NEXTVAL FROM dual
    </selectKey>
    <selectKey keyProperty="licenseNo" resultType="Integer" order="BEFORE">
        SELECT SEQ_LICENSE.NEXTVAL FROM dual
    </selectKey>
    	INSERT INTO users (users_no, users_role, users_id, users_pw, users_name, users_phone, users_nick, users_email, users_rnn)
    	VALUES (#{usersNo}, #{usersRole}, #{usersId}, #{usersPw}, #{usersName}, #{usersPhone}, #{usersNick}, #{usersEmail}, #{usersRnn});

    	INSERT INTO license (license_no, license_detail_no, users_no, file_id, write_dt)
    	VALUES (#{licenseNo}, #{licenseDetailNo}, #{usersNo}, #{fileId}, sysdate);
	</insert>

	<insert id="insertActiveRegion" parameterType="com.yedam.app.usr.service.UserVO">
    	<foreach item="region" collection="regionCode" separator=";">
        	INSERT INTO active_region (users_no, region_code)
        	VALUES (#{usersNo}, #{region});
    	</foreach>
	</insert>

	<insert id="insertActiveCategory" parameterType="com.yedam.app.usr.service.UserVO">
    	<foreach item="category" collection="categoryCode" separator=";">
        	INSERT INTO active_category (users_no, category_code)
        	VALUES (#{usersNo}, #{category});
    	</foreach>
	</insert>

</mapper>