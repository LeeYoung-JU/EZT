<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.wkr.mapper.WorkerMapper">
	<select id="selectCategoryInfo" resultType="java.util.HashMap">
		SELECT FIND_COMMONCODE(category_code) as category_code
		FROM active_category
		WHERE users_no = #{usersNo}
	</select>
	
	<select id="selectRegionInfo" resultType="java.util.HashMap">
		SELECT FIND_COMMONCODE(region_code) as region_code
		FROM active_region
		WHERE users_no = #{usersNo}
	</select>
	
	<!-- 경력증명서 리스트 -->
	<select id="selectCareerList" resultType="CareerVO">
		SELECT career_start_dt
			   , career_end_dt
			   , write_dt
			   , career_info
			   , FIND_COMMONCODE(career_access_tf) as career_access_tf
			   , file_id
		FROM career
		WHERE users_no = #{usersNo}
	</select>
	
	<select id="selectWorkerReviewList" resultType="ReviewVO">
		SELECT *
		FROM review
		WHERE worker = #{usersNo};
	</select>
	
	<select id="selectWorkerTeamReviewList" resultType="MemberVO">
		SELECT *
		FROM review
		WHERE worker IN (SELECT writer
                 		 FROM team
                 		 WHERE team_no IN (SELECT team_no
                                   		   FROM member
                                   		   WHERE users_no = #{usersNo}));
	</select>
	
	<!-- 작업자 정보수정 -->
	<delete id="deleteWorkerRegion" parameterType="UserVO">
		DELETE FROM active_region
		WHERE users_no = #{usersNo}
	</delete>
	
	<delete id="deleteWorkerCategory" parameterType="UserVO">
		DELETE FROM active_category
		WHERE users_no = #{usersNo}
	</delete>

	<insert id="insertWorkerCode" parameterType="UserVO">
		INSERT ALL
		
		<foreach item="region" collection="regionCode" separator="">
		INTO active_region( users_no, region_code ) 
		VALUES ( #{usersNo}, #{region} )
		</foreach>

	
		<foreach item="category" collection="categoryCode" separator="">
		INTO active_category( users_no, category_code )
		VALUES (#{usersNo}, #{category} )
		</foreach>
		
		SELECT *
		FROM dual
	</insert>

	<insert id="insertCareer" parameterType="CareerVO">
		INSERT INTO career( career_no
							, users_no
							, career_info
							, career_start_dt
							, career_end_dt
							, file_id
							, career_access_tf
							, write_dt
							) VALUES (
							 SEQ_CAREER.NEXTVAL
							 , #{usersNo}
							 , #{careerInfo}
							 , #{careerStartDt}
							 , #{careerEndDt}
							 , #{fileId}
							 , 'A01'
							 , sysdate
							)
	</insert>


	<update id="updateWorkerInfo" parameterType="UserVO">
		UPDATE users
		SET users_nick = #{usersNick}
			, users_phone = #{usersPhone}
			, users_email = #{usersEmail}
		WHERE users_id = #{usersId}
	</update>

	<update id="updateWorkerPw" parameterType="UserVO">
		UPDATE users
		SER users_pw = #{usersNewPw}
		WHERE users_id = #{usersId}
	</update>

	
	<update id="updateWorkerState" parameterType="UserVO">
		UPDATE users
		SET users_state = quit
		WHERE users_id = #{usersId}
	</update>
</mapper>