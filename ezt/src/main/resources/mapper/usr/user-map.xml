<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.usr.mapper.UserMapper">
	<!-- 사원정보 조회 -->
	<select id="selectUserInfo" resultType="UserVO">
		SELECT users_no
				, users_id
				, users_pw
				, users_email
				, users_birth
				, users_rnn
				, users_gender
				, users_name
				, users_phone
				, users_nick
				, users_role
				, users_join_dt
				, users_state_change_dt
				, users_state
				, file_id
		FROM users
		WHERE users_id = #{id}
	</select>
	<!-- 중복체크 -->
	<select id="idChk" resultType="int">
		SELECT COUNT(*)
		FROM users
		WHERE users_id = #{usersId}
	</select>
	
	<select id="emailChk" resultType="int">
		SELECT COUNT(*)
		FROM users
		WHERE users_email = #{usersEmail}
	</select>
	
	<select id="nickChk" resultType="int">
		SELECT COUNT(*)
		FROM users
		WHERE users_nick = #{usersNick}
	</select>
	<!-- 사용자 회원가입 -->
	<insert id="saveUser" parameterType="com.yedam.app.usr.service.UserVO">
		<selectKey keyProperty="usersNo" resultType="Integer" order="BEFORE">
			SELECT SEQ_USERS.NEXTVAL
			FROM dual
		</selectKey>
		INSERT INTO users(users_no, users_role, users_id, users_pw, users_name
							, users_phone, users_nick, users_email, users_rnn
							, users_state, users_gender, users_birth, users_state_change_dt )
		VALUES(#{usersNo}, #{usersRole}, #{usersId}, #{usersPw}, #{usersName}
				, #{usersPhone}, #{usersNick}, #{usersEmail}, #{usersRnn}
				, 'active', #{usersGender}, #{usersBirth}, sysdate )
	</insert>
	
	<!-- 작업자 회원가입 -->
	<insert id="saveWorker" parameterType="com.yedam.app.usr.service.UserVO">
		<selectKey keyProperty="usersNo" resultType="Integer" order="BEFORE">
			SELECT SEQ_USERS.NEXTVAL as usersNo
			FROM dual	 
		</selectKey>

		INSERT ALL 
		INTO users(users_no, users_role, users_id, users_pw, users_name, users_phone
					, users_nick, users_email, users_birth, users_rnn, users_state
					, users_gender, users_state_change_dt )
		VALUES(#{usersNo}, #{usersRole}, #{usersId}, #{usersPw}, #{usersName}
				, #{usersPhone}, #{usersNick}, #{usersEmail}, #{usersBirth}
				, #{usersRnn}, 'active', #{usersGender}, sysdate )
					
		INTO license( license_no, license_detail_no, users_no,  write_dt) 
		VALUES ( SEQ_LICENSE.NEXTVAL, #{licenseDetailNo}, #{usersNo}, sysdate )

	
		<foreach item="region" collection="regionCode" separator="">
		INTO active_region( users_no, region_code ) 
		VALUES ( #{usersNo}, #{region} )
		</foreach>

	
		<foreach item="category" collection="categoryCode" separator="">
		INTO active_category( users_no, category_code )
		VALUES (#{usersNo}, #{category} )
		</foreach>
	
		SELECT *
		FROM dual
	</insert>
	
	
	
</mapper>