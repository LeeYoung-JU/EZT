<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.tem.mapper.TeamMapper">
<resultMap type="TeamVO" id="twcMap">
	<collection property="workCategoryVO" javaType="ArrayList" column="team_no" ofType="TeamWorkCategoryVO" select="countMember" />
</resultMap>
<!-- 팀신청 전체 조회 -->
<select id="teamList" resultMap="twcMap">
	SELECT   t.team_no
			,t.work_title
			,t.work_content
			,USERNAME(t.writer) as writer_name
			,t.write_dt
			,t.contract_no
			,FIND_COMMONCODE(r.region_code) as region_code
	FROM team t
		JOIN contract c
		ON c.contract_no = t.contract_no
		JOIN proposal p
		ON p.proposal_no = c.proposal_no
		JOIN request r
		ON r.request_no = p.request_no
	ORDER BY write_dt DESC
</select>
<select id="countMember" resultType="TeamWorkCategoryVO">
	SELECT   FIND_COMMONCODE(work_code) as work_code
			,team_no
			,headcount
			,hire_complete_tf
	FROM team_work_category
	WHERE team_no = #{teamNo}
</select>
<!-- 총인원수 -->
<select id="totalHeadCount" resultType="TeamWorkCategoryVO" >
	SELECT  SUM(headcount)
	FROM team_work_category
	WHERE team_no = #{teamNo}
</select>
</mapper>